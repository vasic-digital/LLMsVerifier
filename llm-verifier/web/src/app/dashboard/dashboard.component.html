<div class="dashboard-container">
  <div class="header">
    <h1>{{title}}</h1>
    <button mat-raised-button color="primary" (click)="refreshData()" [disabled]="loading">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="loading" class="loading">
    <mat-spinner></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <!-- Error Message -->
  <div *ngIf="error" class="error">
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon class="error-icon">error</mat-icon>
        <span>{{error}}</span>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Dashboard Content -->
  <div *ngIf="!loading && !error">
    <!-- Stats Overview -->
    <div class="stats-grid" *ngIf="dashboardStats$ | async as stats">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Total Models</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{stats.totalModels}}</div>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Verified Models</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{stats.verifiedModels}}</div>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Pending Models</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{stats.pendingModels}}</div>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Average Score</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value" [ngClass]="getScoreClass(stats.averageScore)">
            {{stats.averageScore?.toFixed(1) || '0.0'}}
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Total Providers</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{stats.totalProviders}}</div>
        </mat-card-content>
      </mat-card>

      <mat-card>
        <mat-card-header>
          <mat-card-title>Last Verification</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="stat-value">{{formatDate(stats.lastVerification)}}</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Recent Models -->
    <div class="section">
      <h2>Recent Models</h2>
      <div class="models-grid" *ngIf="models$ | async as models">
        <mat-card *ngFor="let model of models" class="model-card">
          <mat-card-header>
            <mat-card-title>{{model.name}}</mat-card-title>
            <mat-card-subtitle>{{model.model_id}}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p><strong>Provider:</strong> {{model.provider_id}}</p>
            <p><strong>Status:</strong> 
              <span [ngClass]="getVerificationStatusClass(model.verification_status)">
                {{model.verification_status}}
              </span>
            </p>
            <p *ngIf="model.overall_score"><strong>Score:</strong> 
              <span [ngClass]="getScoreClass(model.overall_score)">
                {{model.overall_score.toFixed(1)}}
              </span>
            </p>
            <p><strong>Created:</strong> {{formatDate(model.created_at)}}</p>
          </mat-card-content>
          <mat-card-actions>
            <button mat-raised-button color="primary" (click)="verifyModel(model.id)">
              Verify
            </button>
            <button mat-button color="warn" (click)="deleteModel(model.id)">
              Delete
            </button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="section">
      <h2>Recent Activity</h2>
      <mat-card *ngIf="dashboardStats$ | async as stats">
        <mat-card-content>
          <div class="activity-list">
            <div *ngFor="let activity of stats.recentActivity" class="activity-item">
              <mat-icon [ngClass]="activity.type">
                {{activity.type === 'success' ? 'check_circle' : activity.type === 'error' ? 'error' : 'loop'}}
              </mat-icon>
              <div class="activity-content">
                <div class="activity-message">{{activity.message}}</div>
                <div class="activity-time">{{formatDate(activity.timestamp)}}</div>
              </div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Quick Actions -->
    <div class="section">
      <h2>Quick Actions</h2>
      <div class="actions-grid">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Navigation</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <nav>
              <a mat-button routerLink="/models">Models Management</a>
              <a mat-button routerLink="/providers">Provider Configuration</a>
              <a mat-button routerLink="/verification">Verification Results</a>
              <a mat-button routerLink="/reports">Reports</a>
            </nav>
          </mat-card-content>
        </mat-card>

        <mat-card>
          <mat-card-header>
            <mat-card-title>System Info</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <p><strong>API Version:</strong> v1.0.0</p>
            <p><strong>Status:</strong> <span class="status-online">Online</span></p>
            <p><strong>Database:</strong> <span class="status-connected">Connected</span></p>
            <p><strong>WebSocket:</strong> 
              <span [class]="isWebSocketConnected ? 'status-connected' : 'status-disconnected'">
                {{isWebSocketConnected ? 'Connected' : 'Disconnected'}}
              </span>
            </p>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Real-time Events -->
    <div class="events-section">
      <mat-card>
        <mat-card-header>
          <mat-card-title>Real-time Events</mat-card-title>
          <button mat-icon-button (click)="webSocketService.disconnect()" *ngIf="isWebSocketConnected">
            <mat-icon>link_off</mat-icon>
          </button>
          <button mat-icon-button (click)="setupWebSocket()" *ngIf="!isWebSocketConnected">
            <mat-icon>link</mat-icon>
          </button>
        </mat-card-header>
        <mat-card-content>
          <div *ngIf="recentEvents.length === 0" class="no-events">
            <p>No recent events</p>
          </div>
          <div class="events-list" *ngIf="recentEvents.length > 0">
            <div class="event-item" 
                 *ngFor="let event of recentEvents" 
                 [class]="'event-' + event.severity">
              <div class="event-header">
                <span class="event-type">{{event.type}}</span>
                <span class="event-time">{{formatDate(event.timestamp)}}</span>
              </div>
              <div class="event-message">{{event.message}}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>