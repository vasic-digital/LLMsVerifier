<form [formGroup]="modelForm" (ngSubmit)="onSubmit()" class="model-form">
  <div class="form-header">
    <h3>{{isEditing ? 'Edit Model' : 'Create New Model'}}</h3>
    <div class="form-actions">
      <button type="button" mat-button (click)="onCancel()">
        <mat-icon>close</mat-icon>
        Cancel
      </button>
    </div>
  </div>

  <div class="form-content">
    <!-- Basic Information -->
    <mat-expansion-panel [expanded]="true" class="form-section">
      <mat-expansion-panel-header>
        <mat-panel-title>Basic Information</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-expansion-panel-content>
        <div class="form-grid">
          <!-- Provider -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Provider *</mat-label>
            <mat-select formControlName="provider_id">
              <mat-option value="">Select a Provider</mat-option>
              <mat-option *ngFor="let provider of providers" [value]="provider.id">
                {{provider.name}} ({{provider.endpoint}})
              </mat-option>
            </mat-select>
            <mat-error *ngIf="modelForm.get('provider_id')?.touched && modelForm.get('provider_id')?.invalid">
              {{getErrorMessage('provider_id')}}
            </mat-error>
          </mat-form-field>

          <!-- Model ID -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Model ID *</mat-label>
            <input matInput formControlName="model_id" placeholder="e.g., gpt-4, claude-3-opus">
            <mat-error *ngIf="modelForm.get('model_id')?.touched && modelForm.get('model_id')?.invalid">
              {{getErrorMessage('model_id')}}
            </mat-error>
          </mat-form-field>

          <!-- Name -->
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Name *</mat-label>
            <input matInput formControlName="name" placeholder="e.g., GPT-4, Claude 3 Opus">
            <mat-error *ngIf="modelForm.get('name')?.touched && modelForm.get('name')?.invalid">
              {{getErrorMessage('name')}}
            </mat-error>
          </mat-form-field>

          <!-- Description -->
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" placeholder="Describe the model..." rows="3"></textarea>
            <mat-error *ngIf="modelForm.get('description')?.touched && modelForm.get('description')?.invalid">
              {{getErrorMessage('description')}}
            </mat-error>
          </mat-form-field>

          <!-- Version -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Version</mat-label>
            <input matInput formControlName="version" placeholder="e.g., 1.0, latest">
            <mat-error *ngIf="modelForm.get('version')?.touched && modelForm.get('version')?.invalid">
              {{getErrorMessage('version')}}
            </mat-error>
          </mat-form-field>

          <!-- Architecture -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Architecture</mat-label>
            <input matInput formControlName="architecture" placeholder="e.g., Transformer, MoE">
            <mat-error *ngIf="modelForm.get('architecture')?.touched && modelForm.get('architecture')?.invalid">
              {{getErrorMessage('architecture')}}
            </mat-error>
          </mat-form-field>
        </div>
      </mat-expansion-panel-content>
    </mat-expansion-panel>

    <!-- Technical Specifications -->
    <mat-expansion-panel class="form-section">
      <mat-expansion-panel-header>
        <mat-panel-title>Technical Specifications</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-expansion-panel-content>
        <div class="form-grid">
          <!-- Parameter Count -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Parameter Count</mat-label>
            <input matInput type="number" formControlName="parameter_count" placeholder="e.g., 175000000000">
            <mat-hint>Enter number of parameters (e.g., 175B for 175 billion)</mat-hint>
            <mat-error *ngIf="modelForm.get('parameter_count')?.touched && modelForm.get('parameter_count')?.invalid">
              {{getErrorMessage('parameter_count')}}
            </mat-error>
          </mat-form-field>

          <!-- Context Window -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Context Window (tokens)</mat-label>
            <input matInput type="number" formControlName="context_window_tokens" placeholder="e.g., 128000">
            <mat-error *ngIf="modelForm.get('context_window_tokens')?.touched && modelForm.get('context_window_tokens')?.invalid">
              {{getErrorMessage('context_window_tokens')}}
            </mat-error>
          </mat-form-field>

          <!-- Max Output Tokens -->
          <mat-form-field appearance="outline" class="form-field">
            <mat-label>Max Output Tokens</mat-label>
            <input matInput type="number" formControlName="max_output_tokens" placeholder="e.g., 4096">
            <mat-error *ngIf="modelForm.get('max_output_tokens')?.touched && modelForm.get('max_output_tokens')?.invalid">
              {{getErrorMessage('max_output_tokens')}}
            </mat-error>
          </mat-form-field>

          <!-- Use Case -->
          <mat-form-field appearance="outline" class="form-field full-width">
            <mat-label>Primary Use Case</mat-label>
            <mat-select formControlName="use_case">
              <mat-option value="">Select use case</mat-option>
              <mat-option value="general">General Purpose</mat-option>
              <mat-option value="code">Code Generation</mat-option>
              <mat-option value="chat">Chat & Conversational</mat-option>
              <mat-option value="analysis">Text Analysis</mat-option>
              <mat-option value="creative">Creative Writing</mat-option>
              <mat-option value="translation">Translation</mat-option>
              <mat-option value="summarization">Summarization</mat-option>
            </mat-select>
            <mat-error *ngIf="modelForm.get('use_case')?.touched && modelForm.get('use_case')?.invalid">
              {{getErrorMessage('use_case')}}
            </mat-error>
          </mat-form-field>
        </div>
      </mat-expansion-panel-content>
    </mat-expansion-panel>

    <!-- Capabilities -->
    <mat-expansion-panel class="form-section">
      <mat-expansion-panel-header>
        <mat-panel-title>Capabilities</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-expansion-panel-content>
        <div class="capabilities-grid">
          <mat-checkbox formControlName="is_multimodal">
            Multimodal
          </mat-checkbox>
          <mat-checkbox formControlName="supports_vision">
            Vision Processing
          </mat-checkbox>
          <mat-checkbox formControlName="supports_audio">
            Audio Processing
          </mat-checkbox>
          <mat-checkbox formControlName="supports_video">
            Video Processing
          </mat-checkbox>
          <mat-checkbox formControlName="supports_reasoning">
            Advanced Reasoning
          </mat-checkbox>
          <mat-checkbox formControlName="open_source">
            Open Source
          </mat-checkbox>
          <mat-checkbox formControlName="deprecated">
            Deprecated
          </mat-checkbox>
        </div>
      </mat-expansion-panel-content>
    </mat-expansion-panel>

    <!-- Tags and Languages -->
    <mat-expansion-panel class="form-section">
      <mat-expansion-panel-header>
        <mat-panel-title>Tags & Languages</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-expansion-panel-content>
        <!-- Tags -->
        <div class="form-group">
          <label>Tags</label>
          <mat-chip-listbox>
            <mat-chip *ngFor="let tag of modelForm.get('tags')?.value; let i = index" 
                      [removable]="true" (removed)="removeTag(tag)">
              {{tag}}
            </mat-chip>
            <mat-chip-input #tagInput placeholder="Add tag..." 
                           (matChipInputTokenEnd)="addTag($event)">
            </mat-chip-input>
          </mat-chip-listbox>
        </div>

        <!-- Language Support -->
        <div class="form-group">
          <label>Supported Languages</label>
          <mat-chip-listbox>
            <mat-chip *ngFor="let language of modelForm.get('language_support')?.value; let i = index" 
                      [removable]="true" (removed)="removeLanguage(language)">
              {{language}}
            </mat-chip>
            <mat-chip-input #langInput placeholder="Add language..." 
                           (matChipInputTokenEnd)="addLanguage($event)">
            </mat-chip-input>
          </mat-chip-listbox>
        </div>
      </mat-expansion-panel-content>
    </mat-expansion-panel>

    <!-- Scoring -->
    <mat-expansion-panel class="form-section">
      <mat-expansion-panel-header>
        <mat-panel-title>Performance Scores</mat-panel-title>
      </mat-expansion-panel-header>
      <mat-expansion-panel-content>
        <div class="scores-grid">
          <mat-form-field appearance="outline">
            <mat-label>Overall Score</mat-label>
            <input matInput type="number" formControlName="overall_score" min="0" max="100">
            <mat-hint>0-100</mat-hint>
            <mat-error *ngIf="modelForm.get('overall_score')?.touched && modelForm.get('overall_score')?.invalid">
              {{getErrorMessage('overall_score')}}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Code Capability</mat-label>
            <input matInput type="number" formControlName="code_capability_score" min="0" max="100">
            <mat-hint>0-100</mat-hint>
            <mat-error *ngIf="modelForm.get('code_capability_score')?.touched && modelForm.get('code_capability_score')?.invalid">
              {{getErrorMessage('code_capability_score')}}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Responsiveness</mat-label>
            <input matInput type="number" formControlName="responsiveness_score" min="0" max="100">
            <mat-hint>0-100</mat-hint>
            <mat-error *ngIf="modelForm.get('responsiveness_score')?.touched && modelForm.get('responsiveness_score')?.invalid">
              {{getErrorMessage('responsiveness_score')}}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Reliability</mat-label>
            <input matInput type="number" formControlName="reliability_score" min="0" max="100">
            <mat-hint>0-100</mat-hint>
            <mat-error *ngIf="modelForm.get('reliability_score')?.touched && modelForm.get('reliability_score')?.invalid">
              {{getErrorMessage('reliability_score')}}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Feature Richness</mat-label>
            <input matInput type="number" formControlName="feature_richness_score" min="0" max="100">
            <mat-hint>0-100</mat-hint>
            <mat-error *ngIf="modelForm.get('feature_richness_score')?.touched && modelForm.get('feature_richness_score')?.invalid">
              {{getErrorMessage('feature_richness_score')}}
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Value Proposition</mat-label>
            <input matInput type="number" formControlName="value_proposition_score" min="0" max="100">
            <mat-hint>0-100</mat-hint>
            <mat-error *ngIf="modelForm.get('value_proposition_score')?.touched && modelForm.get('value_proposition_score')?.invalid">
              {{getErrorMessage('value_proposition_score')}}
            </mat-error>
          </mat-form-field>

          <!-- Verification Status -->
          <mat-form-field appearance="outline">
            <mat-label>Verification Status</mat-label>
            <mat-select formControlName="verification_status">
              <mat-option value="pending">Pending</mat-option>
              <mat-option value="verified">Verified</mat-option>
              <mat-option value="failed">Failed</mat-option>
            </mat-select>
            <mat-error *ngIf="modelForm.get('verification_status')?.touched && modelForm.get('verification_status')?.invalid">
              {{getErrorMessage('verification_status')}}
            </mat-error>
          </mat-form-field>
        </div>
      </mat-expansion-panel-content>
    </mat-expansion-panel>
  </div>

  <!-- Form Actions -->
  <div class="form-footer">
    <div class="error-message" *ngIf="error">
      <mat-icon class="error-icon">error</mat-icon>
      {{error}}
    </div>
    <div class="action-buttons">
      <button type="button" mat-button (click)="onCancel()">
        Cancel
      </button>
      <button type="submit" mat-raised-button color="primary" [disabled]="modelForm.invalid || loading">
        <mat-icon *ngIf="loading">loop</mat-icon>
        {{loading ? 'Saving...' : (isEditing ? 'Update Model' : 'Create Model')}}
      </button>
    </div>
  </div>
</form>